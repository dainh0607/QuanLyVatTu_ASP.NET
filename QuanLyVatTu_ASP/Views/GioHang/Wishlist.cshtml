@model IEnumerable<QuanLyVatTu_ASP.Areas.Admin.Models.YeuThich>
@{
    ViewData["Title"] = "Danh sách yêu thích - QLVT";
    Layout = "~/Views/Shared/_Layout_Customer.cshtml";
}

<div class="wishlist-page">
    <div class="container">
        <div class="page-header">
            <h1>Danh sách yêu thích</h1>
            <p>Các sản phẩm bạn đã lưu để xem sau</p>
        </div>

        <div class="wishlist-content">
            <div class="wishlist-items">
                @if (Model != null && Model.Any())
                {
                    foreach (var item in Model)
                    {
                        var product = item.VatTu;
                        <div class="wishlist-item" data-id="@product.ID" data-price="@(product.GiaBan ?? 0)">
                            <div class="item-image">
                                <!-- Assuming image path convention -->
                                <img src="/user/images/@($"{product.TenVatTu}.jpg")" alt="@product.TenVatTu" onerror="this.src='https://via.placeholder.com/150x150?text=No+Image'">
                                <button class="remove-wishlist" title="Xóa khỏi danh sách yêu thích" onclick="removeItem(this, @item.ID)">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="item-info">
                                <h3 class="item-name">@product.TenVatTu</h3>
                                <div class="item-rating">
                                    <div class="stars">
                                        <!-- Placeholder stars or derived from product if available -->
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                    </div>
                                    <span class="rating-count">(Đánh giá)</span>
                                </div>
                                <div class="item-price">
                                    <span class="current-price">@(product.GiaBan?.ToString("N0") ?? "0")đ</span>
                                    <!-- Only show original price if we had it, omitting for now -->
                                </div>
                                <div class="item-stock">
                                    @if(product.SoLuongTon > 0)
                                    {
                                        <span class="in-stock text-success">Còn hàng (@product.SoLuongTon)</span>
                                    }
                                    else
                                    {
                                        <span class="out-of-stock text-danger">Hết hàng</span>
                                    }
                                </div>
                            </div>
                            <div class="item-actions">
                                @if(product.SoLuongTon > 0)
                                {
                                    <button class="btn-primary add-to-cart" onclick="addToCart(@product.ID)">
                                        <i class="fas fa-shopping-cart"></i>
                                        Thêm vào giỏ
                                    </button>
                                }
                                else
                                {
                                    <button class="btn-primary add-to-cart" disabled>
                                        <i class="fas fa-shopping-cart"></i>
                                        Hết hàng
                                    </button>
                                }
                                <a href="/SanPham/ProductDetail/@product.ID" class="btn-secondary view-details text-decoration-none text-center pt-2">
                                    Xem chi tiết
                                </a>
                            </div>
                        </div>
                    }
                }
            </div>

            <div class="wishlist-sidebar">
                <div class="sidebar-card">
                    <h3>Thông tin danh sách</h3>
                    <div class="wishlist-stats">
                        <div class="stat-item">
                            <span class="stat-label">Tổng sản phẩm:</span>
                            <span class="stat-value" id="wishlist-count">3</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Tổng giá trị:</span>
                            <span class="stat-value" id="wishlist-total">0đ</span>
                        </div>
                    </div>
                </div>

                <div class="sidebar-card">
                    <h3>Khuyến mãi đặc biệt</h3>
                    <div class="promo-banner">
                        <p>Giảm thêm 10% khi mua 2 sản phẩm từ danh sách yêu thích</p>
                        <small>Áp dụng đến 31/12/2024</small>
                    </div>
                </div>

                <div class="sidebar-card">
                    <h3>Gợi ý cho bạn</h3>
                    <div class="suggested-products">
                        <div class="suggested-item">
                            <img src="https://via.placeholder.com/60x60" alt="Sản phẩm gợi ý">
                            <div class="suggested-info">
                                <h4>Máy cắt sắt</h4>
                                <span class="price">890.000đ</span>
                            </div>
                        </div>
                        <div class="suggested-item">
                            <img src="https://via.placeholder.com/60x60" alt="Sản phẩm gợi ý">
                            <div class="suggested-info">
                                <h4>Kìm điện tử</h4>
                                <span class="price">120.000đ</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="empty-wishlist hidden" id="empty-state">
            <div class="empty-icon">
                <i class="far fa-heart"></i>
            </div>
            <h3>Danh sách yêu thích trống</h3>
            <p>Bạn chưa có sản phẩm nào trong danh sách yêu thích</p>
            <a href="/SanPham" class="btn-primary">Khám phá sản phẩm</a>
        </div>
    </div>
</div>


    <link rel="stylesheet" href="~/user/css/wishlist.css" />
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            calculateTotal();
        });

        function calculateTotal() {
            const items = document.querySelectorAll('.wishlist-item');
            let total = 0;
            
            items.forEach(item => {
                const price = parseFloat(item.getAttribute('data-price')) || 0;
                total += price;
            });

            document.getElementById('wishlist-count').textContent = items.length;
            document.getElementById('wishlist-total').textContent = total.toLocaleString('vi-VN') + 'đ';

            if (items.length === 0) {
                document.querySelector('.wishlist-content').style.display = 'none';
                document.getElementById('empty-state').classList.remove('hidden');
            }
        }

        function removeItem(btn) {
            showGlobalConfirm('Bạn có chắc muốn xóa sản phẩm này?', function() {
                const item = btn.closest('.wishlist-item');
                item.remove();
                calculateTotal();
            });
        }

        function addToCart(id) {
            $.post('/GioHang/AddToCart', { productId: id, quantity: 1 }, function(res) {
                if(res.success) {
                    showGlobalMessage("Đã thêm vào giỏ hàng!", "Thành công", "success");
                    // Update cart badge if exists
                    if(res.cartCount !== undefined) {
                        $('.cart-count').text(res.cartCount);
                    }
                } else {
                    showGlobalMessage("Có lỗi xảy ra, vui lòng thử lại.", "Lỗi", "error");
                }
            }).fail(function() {
                showGlobalMessage("Không thể kết nối đến máy chủ.", "Lỗi Kết Nối", "error");
            });
        }
    </script>
