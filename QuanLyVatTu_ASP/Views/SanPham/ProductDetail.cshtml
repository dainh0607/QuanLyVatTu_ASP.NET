@model QuanLyVatTu_ASP.Areas.Admin.Models.VatTu
@{
    ViewData["Title"] = Model.TenVatTu;

    // Danh sách ảnh có sẵn trong folder wwwroot/user/images
    var availableImages = new string[] {
        "/user/images/Máy khoan cầm tay mẫu 1.jpg",
        "/user/images/Máy khoan cầm tay mẫu 2.jpg",
        "/user/images/Máy khoan cầm tay mẫu 3.jpg",
        "/user/images/Máy khoan cầm tay mẫu 4.jpg",
        "/user/images/Máy cắt - Uốn.jpg",
        "/user/images/Máy cắt bê tông KC16 (Không động cơ).jpg",
        "/user/images/Máy cắt sắt thủy lực cầm tay RC-25.jpg",
        "/user/images/Máy làm nền.jpg",
        "/user/images/Máy mài sàn bê tông DMS250.jpg",
        "/user/images/Máy xoa nền đôi Conmec (Ngồi lái).jpg",
        "/user/images/Máy xoa nền đơn Honda GX160.jpg",
        "/user/images/Máy đầm cóc Mikasa MT55.jpg",
        "/user/images/Máy đầm dùi chạy điện Jinlong 1.5KW.jpg",
        "/user/images/Máy đầm.jpg",
        "/user/images/Đầm bàn PC60.jpg"
    };

    // Helper function để lấy ảnh cho sản phẩm (xoay vòng theo ID)
    Func<int, string?, string> GetProductImage = (productId, existingImage) => {
        if (!string.IsNullOrEmpty(existingImage)) return existingImage;
        return availableImages[productId % availableImages.Length];
    };

    // Lấy ảnh cho sản phẩm hiện tại
    var mainProductImage = GetProductImage(Model.ID, Model.HinhAnh);
}
<style>
    /* Custom Shopee-like Styles */
    :root {
        --shopee-orange: #d0011b; /* Shopee brand color fallback */
        --shopee-price: #ee4d2d;
        --shopee-black: #000;
    }
    
    .product-detail-page {
        background-color: #f5f5f5;
        padding-top: 20px;
    }

    .shopee-box {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        padding: 20px;
        margin-bottom: 20px;
        border: 1px solid #f0f0f0;
    }

    /* Gallery */
    .active-thumb {
        border: 2px solid var(--shopee-price) !important;
        border-radius: 8px !important;
    }

    /* Product Info */
    .product-title {
        font-size: 1.5rem;
        font-weight: 600;
        line-height: 1.2;
        color: #222;
        margin-bottom: 12px;
    }

    .product-price-box {
        background: #fafafa;
        padding: 15px 20px;
        margin-bottom: 25px;
        border-radius: 8px;
    }

    .product-price {
        font-size: 2rem;
        font-weight: 600;
        color: #d0011b; /* Shopee Red/Orange match */
    }

    .shopee-btn-black {
        background-color: #000;
        color: #fff;
        border: 1px solid #000;
        border-radius: 8px;
        height: 48px;
        font-size: 16px;
        text-transform: uppercase;
        font-weight: 600;
        transition: all 0.3s ease;
        font-size: 16px;
        text-transform: uppercase;
        font-weight: 500;
    }
    .shopee-btn-black:hover {
        background-color: #333;
        color: #fff;
    }

    .shopee-btn-primary {
        background-color: var(--shopee-orange);
        color: #fff;
        border: 1px solid var(--shopee-orange);
        border-radius: 8px;
        height: 48px;
        font-size: 16px;
        text-transform: uppercase;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    .shopee-btn-primary:hover {
        background-color: #a80015;
        color: #fff;
    }

    /* Policy Sidebar */
    .policy-list .policy-item {
        display: flex;
        align-items: flex-start;
        margin-bottom: 15px;
        font-size: 0.9rem;
    }
    .policy-item i {
        width: 25px;
        margin-top: 3px;
    }

    /* Reviews */
    .review-section-header {
        font-size: 1.125rem;
        color: rgba(0,0,0,.87);
        margin-bottom: 1.5rem;
        text-transform: uppercase;
        font-weight: 500;
    }
    
    .review-form-container {
        background-color: #f0f7ff; /* Light blue tint from image */
        border-radius: 8px;
        padding: 20px;
    }
    
    .star-rating i {
        cursor: pointer;
        font-size: 24px;
        color: #ccc;
        transition: color 0.2s;
    }
    .star-rating i.active, .star-rating i:hover, .star-rating i.hover {
        color: #ffc107; /* Warning yellow */
    }

</style>

<div class="product-detail-page pb-5">
    <div class="container">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-3">
            <ol class="breadcrumb mb-0 small">
                <li class="breadcrumb-item"><a href="/" class="text-decoration-none text-muted">Trang chủ</a></li>
                <li class="breadcrumb-item"><a href="/SanPham" class="text-decoration-none text-muted">Danh mục sản phẩm</a></li>
                <li class="breadcrumb-item active" aria-current="page">@Model.TenVatTu</li>
            </ol>
        </nav>

        <!-- Main Product Section -->
        <div class="shopee-box">
            <div class="row g-4">
                <!-- 1. Column: Image (Left) -->
                <div class="col-lg-5">
                    <div class="product-gallery">
                        <div class="main-image mb-3 border border-light d-flex align-items-center justify-content-center bg-white" style="height: 400px; cursor: pointer; border-radius: 12px; overflow: hidden;">
                            <img src="@mainProductImage" 
                                 alt="@Model.TenVatTu" id="currentImg" class="img-fluid" style="max-height: 100%; object-fit: contain;" />
                        </div>
                        <div class="d-flex gap-2 overflow-auto">
                            <!-- Main Thumb -->
                             <img src="@mainProductImage" 
                                  class="border active-thumb cursor-pointer" 
                                  style="width: 82px; height: 82px; object-fit: cover; border-radius: 8px;"
                                  onclick="changeImage(this)" alt="Thumb">
                            
                            <!-- Related Thumbs (Mock or actual logic) -->
                            @if (ViewBag.RelatedProducts != null)
                            {
                                int limit = 0;
                                foreach (var item in (IEnumerable<QuanLyVatTu_ASP.Areas.Admin.Models.VatTu>)ViewBag.RelatedProducts)
                                {
                                    if(limit++ > 3) break;
                                    <img src="@GetProductImage(item.ID, item.HinhAnh)" 
                                         class="border cursor-pointer opacity-75 hover-opacity-100" 
                                         style="width: 82px; height: 82px; object-fit: cover; border-radius: 8px;"
                                         onclick="changeImage(this)" alt="@item.TenVatTu">
                                }
                            }
                        </div>
                    </div>
                </div>

                <!-- 2. Column: Info (Center) -->
                <div class="col-lg-4 border-end-lg">
                    <h1 class="product-title fw-bold">@Model.TenVatTu</h1>
                    
                    <div class="d-flex align-items-center mb-3 small">
                        <div class="text-warning me-2" id="headerRatingStars">
                            <!-- Will be filled by JS or default -->
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                        <span class="text-danger border-bottom border-danger me-3">4.9</span>
                        <span class="text-muted border-start ps-3 me-3">1.2k Đánh giá</span>
                        <span class="text-muted border-start ps-3">Đã bán 5.4k</span>
                    </div>

                    <div class="product-price-box">
                        <span class="product-price text-warning">@(Model.GiaBan?.ToString("N0") ?? "0")đ</span>
                    </div>

                    <div class="mb-4 small">
                        <div class="mb-2">
                            <span class="text-muted w-25 d-inline-block">Mã sản phẩm:</span>
                            <span>@Model.ID</span>
                        </div>
                        <div class="mb-2">
                            <span class="text-muted w-25 d-inline-block">Tình trạng:</span>
                            @if (Model.SoLuongTon > 0)
                            {
                                <span class="text-success">Còn hàng</span>
                            }
                            else
                            {
                                <span class="text-danger">Hết hàng</span>
                            }
                        </div>
                        <div class="mb-2">
                            <p class="text-muted mb-0">Sản phẩm chất lượng cao, bền bỉ, phù hợp với mọi nhu cầu sử dụng của gia đình và công trình.</p>
                        </div>
                    </div>

                    @if (Model.SoLuongTon > 0)
                    {
                        <div class="quantity-section mb-4">
                            <span class="text-muted small d-block mb-2">Số lượng:</span>
                            <div class="d-flex align-items-center">
                                <div class="input-group" style="width: 120px;">
                                    <button class="btn btn-outline-secondary btn-sm" style="border-radius: 8px 0 0 8px;" type="button" onclick="updateQty(-1)">-</button>
                                    <input type="text" id="qty" class="form-control form-control-sm text-center border-secondary" value="1" min="1" max="@Model.SoLuongTon">
                                    <button class="btn btn-outline-secondary btn-sm" style="border-radius: 0 8px 8px 0;" type="button" onclick="updateQty(1)">+</button>
                                </div>
                                <span class="ms-3 small text-muted">@Model.SoLuongTon sản phẩm có sẵn</span>
                            </div>
                        </div>

                        <div class="d-flex gap-3">
                            <button class="btn shopee-btn-black flex-grow-1" onclick="addToCart(@Model.ID)">
                                <i class="fas fa-shopping-cart me-2"></i> THÊM VÀO GIỎ HÀNG
                            </button>
                            <button class="btn shopee-btn-primary flex-grow-1" onclick="buyNow(@Model.ID)">
                                Mua Ngay
                            </button>
                        </div>
                    }
                    else
                    {
                        <button class="btn btn-secondary w-100 rounded-0" disabled>TẠM HẾT HÀNG</button>
                    }
                </div>

                <!-- 3. Column: Policies (Right) -->
                <div class="col-lg-3">
                    <div class="ps-lg-3">
                        <div class="policy-list">
                            <div class="policy-item">
                                <i class="fas fa-phone-alt text-danger me-2"></i>
                                <div>
                                    <span class="fw-bold d-block">SĐT/Zalo:</span>
                                    <span class="text-primary">0302370432</span>
                                </div>
                            </div>
                            <div class="policy-item">
                                <i class="fas fa-shipping-fast text-warning me-2"></i>
                                <div>
                                    <span class="fw-bold d-block">Giao hàng nhanh chóng</span>
                                    <span class="text-muted small">Vận chuyển toàn quốc</span>
                                </div>
                            </div>
                            <div class="policy-item">
                                <i class="fas fa-clock text-info me-2"></i>
                                <div>
                                    <span class="fw-bold d-block">Giờ làm việc</span>
                                    <span class="text-muted small">8h30 - 17h30 (T2 - T7)</span>
                                </div>
                            </div>
                            <div class="policy-item">
                                <i class="fas fa-globe text-success me-2"></i>
                                <div>
                                    <span class="fw-bold d-block">Mua online:</span>
                                    <span class="text-muted small">cuahangvattu.com</span>
                                </div>
                            </div>
                            <div class="policy-item">
                                <i class="fas fa-sync-alt text-success me-2"></i>
                                <div>
                                    <span class="fw-bold d-block">Đổi trả dễ dàng</span>
                                    <span class="text-muted small">Chính sách đổi trả trong 7 ngày</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Product Description & Reviews -->
        <!-- We use simple stacked layout -->
        
        <!-- Description -->
        <div class="shopee-box">
             <div class="bg-light p-3 mb-3">
                 <h5 class="m-0 text-uppercase text-dark" style="font-size: 1.125rem;">CHI TIẾT SẢN PHẨM</h5>
             </div>
             <div class="product-description p-3" style="line-height: 1.8; color: rgba(0,0,0,.8);">
                 @Html.Raw(Model.MoTa?.Replace("\n", "<br>"))
             </div>
        </div>
        
        <!-- Reviews Section -->
        <div class="shopee-box" id="reviews-section">
            <h5 class="review-section-header">ĐÁNH GIÁ SẢN PHẨM</h5>
            
            <!-- Write Review Form -->
            <div class="mb-4">
                 @if (Context.Session.GetInt32("KhachHangId") != null)
                 {
                    <div class="review-form-container">
                        <div class="d-flex align-items-center mb-3">
                            <i class="far fa-edit text-primary me-2 fst-normal"></i>
                            <h6 class="m-0 text-primary fw-bold">Viết đánh giá của bạn</h6>
                        </div>
                        <form id="reviewForm">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label small fw-bold">Đánh giá sao <span class="text-danger">*</span></label>
                                    <div class="star-rating" id="starRatingInput">
                                        <i class="fas fa-star" data-value="1"></i>
                                        <i class="fas fa-star" data-value="2"></i>
                                        <i class="fas fa-star" data-value="3"></i>
                                        <i class="fas fa-star" data-value="4"></i>
                                        <i class="fas fa-star" data-value="5"></i>
                                        <input type="hidden" id="ratingValue" name="rating" value="5">
                                    </div>
                                </div>
                                <div class="col-md-6 text-md-end">
                                    <span class="small text-muted">Chất lượng sản phẩm</span>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label small fw-bold">Nhận xét của bạn</label>
                                <textarea class="form-control border-0 rounded-3 shadow-sm p-3" id="reviewComment" rows="4" placeholder="Chia sẻ trải nghiệm của bạn về sản phẩm này..."></textarea>
                            </div>
                            
                            <button type="submit" class="btn btn-primary px-4 fw-bold">
                                <i class="fas fa-paper-plane me-2"></i> Gửi đánh giá
                            </button>
                        </form>
                    </div>
                 }
                 else
                 {
                    <div class="alert alert-info border-0 d-flex align-items-center">
                        <i class="fas fa-info-circle me-3 fs-4"></i>
                        <div>
                             Vui lòng <a href="/Account/Login?returnUrl=/SanPham/ProductDetail/@Model.ID" class="fw-bold text-decoration-none">đăng nhập</a> để viết đánh giá.
                        </div>
                    </div>
                 }
            </div>

            <!-- Filters -->
             <div class="review-filters bg-light p-4 rounded-4 border border-light mb-4 d-flex align-items-center gap-2 flex-wrap" style="background-color: #fffbf8; border: 1px solid #f9ede5;">
                <div class="text-center me-4">
                     <div class="text-danger fs-3 fw-bold"><span id="avgScore">4.9</span> <span class="fs-6 text-muted">trên 5</span></div>
                     <div class="text-warning small" id="avgStarsDisplay">
                         <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                     </div>
                </div>
                <button class="btn btn-outline-secondary bg-white px-3 active filter-btn rounded-pill border-0 shadow-sm" data-filter="all">Tất cả</button>
                <button class="btn btn-outline-secondary bg-white px-3 filter-btn rounded-pill border-0 shadow-sm" data-filter="5">5 Sao</button>
                <button class="btn btn-outline-secondary bg-white px-3 filter-btn rounded-pill border-0 shadow-sm" data-filter="4">4 Sao</button>
                <button class="btn btn-outline-secondary bg-white px-3 filter-btn rounded-pill border-0 shadow-sm" data-filter="3">3 Sao</button>
                <button class="btn btn-outline-secondary bg-white px-3 filter-btn rounded-pill border-0 shadow-sm" data-filter="2">2 Sao</button>
                <button class="btn btn-outline-secondary bg-white px-3 filter-btn rounded-pill border-0 shadow-sm" data-filter="1">1 Sao</button>
            </div>

            <!-- Reviews List -->
            <div id="reviewsList" class="d-flex flex-column gap-3">
                <!-- Ajax Load -->
            </div>
        </div>

        <!-- Related Products -->
        @if (ViewBag.RelatedProducts != null)
        {
            <div class="mt-4">
                <h5 class="text-uppercase text-secondary fw-bold mb-3">SẢN PHẨM LIÊN QUAN</h5>
                <div class="row row-cols-2 row-cols-md-4 row-cols-lg-6 g-3">
                    @foreach (var item in (IEnumerable<QuanLyVatTu_ASP.Areas.Admin.Models.VatTu>)ViewBag.RelatedProducts)
                    {
                        <div class="col">
                            <div class="card h-100 border-0 shadow-sm hover-shadow transition-all rounded-4 overflow-hidden">
                                <a href="/SanPham/ProductDetail/@item.ID" class="text-decoration-none text-dark">
                                    <div class="position-relative bg-white rounded-4 m-2 border border-light">
                                        <img src="@GetProductImage(item.ID, item.HinhAnh)" 
                                             class="card-img-top p-2" alt="@item.TenVatTu" style="height: 180px; object-fit: contain;">
                                        @if(item.HinhAnh == null) {
                                            <!-- Fallback visible if image broken handled by error event ideally -->
                                        }
                                    </div>
                                    <div class="card-body p-3">
                                        <h6 class="card-title text-truncate mb-1 fw-bold text-dark">@item.TenVatTu</h6>
                                        <div class="d-flex justify-content-between align-items-center mt-2">
                                            <span class="text-danger fw-bold header-font">@(item.GiaBan?.ToString("N0") ?? "0")đ</span>
                                            <span class="text-muted small" style="font-size: 0.75rem;">Đã bán 123</span>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    }
                </div>
            </div>
        }
    </div>
</div>

<!-- Add Cart Modal -->
<div class="modal fade" id="cartModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-sm">
    <div class="modal-content text-center border-0 rounded-3">
      <div class="modal-body py-4">
          <div class="mb-3 text-success">
              <i class="fas fa-check-circle" style="font-size: 3rem;"></i>
          </div>
          <h5 class="fw-bold mb-2">Đã thêm vào giỏ</h5>
          <p class="text-muted small mb-4">Sản phẩm đã được thêm vào giỏ hàng của bạn.</p>
          <div class="d-grid gap-2">
              <a href="/GioHang/GioHang" class="btn btn-primary btn-sm">Xem giỏ hàng</a>
              <button type="button" class="btn btn-light btn-sm text-muted" data-bs-dismiss="modal">Mua tiếp</button>
          </div>
      </div>
    </div>
  </div>
</div>

@section Scripts {
    <script>
        const productId = @Model.ID;

        // Image Gallery
        function changeImage(el) {
            document.getElementById('currentImg').src = el.src.replace('100x100', '600x600'); // simplistic replace if needed
            document.querySelectorAll('.active-thumb').forEach(t => t.classList.remove('active-thumb'));
            el.classList.add('active-thumb');
        }

        // Qty
        function updateQty(delta) {
            const input = document.getElementById('qty');
            let val = parseInt(input.value) + delta;
            let max = parseInt(input.getAttribute('max'));
            if(val < 1) val = 1;
            if(val > max) val = max;
            input.value = val;
        }

        // Add to Cart
        function addToCart(id) {
            const qty = document.getElementById('qty').value;
             $.post('/GioHang/AddToCart', { productId: id, quantity: qty }, function(res) {
                if(res.success) {
                    new bootstrap.Modal(document.getElementById('cartModal')).show();
                    // Update cart count if exists in layout
                    if(res.count && $('.cart-count').length) $('.cart-count').text(res.count);
                } else {
                    alert(res.message);
                }
            }).fail(function() {
                alert('Lỗi kết nối');
            });
        }

        // Buy Now
        function buyNow(id) {
            const qty = document.getElementById('qty').value;
             $.post('/GioHang/BuyNow', { productId: id, quantity: qty }, function(res) {
                if(res.success) {
                    window.location.href = "/ThanhToan/Checkout?isBuyNow=true";
                } else {
                    alert(res.message);
                }
            }).fail(function() {
                alert('Lỗi kết nối');
            });
        }

        // Reviews Logic
        $(document).ready(function() {
            loadReviews(); // Initial load

            // Star Interaction in Form
            $('.star-rating i').hover(
                function() {
                    const val = $(this).data('value');
                    $(this).parent().children('i').each(function() {
                        if($(this).data('value') <= val) $(this).addClass('hover');
                        else $(this).removeClass('hover');
                    });
                },
                function() {
                    $(this).parent().children('i').removeClass('hover');
                }
            ).click(function() {
                const val = $(this).data('value');
                $('#ratingValue').val(val);
                $(this).parent().children('i').each(function() {
                    if($(this).data('value') <= val) $(this).addClass('active text-warning').removeClass('far').addClass('fas');
                    else $(this).removeClass('active text-warning checked').removeClass('fas').addClass('far'); // reset
                });
                // Explicitly set colors for persistent state
                $(this).parent().children('i').css('color', ''); // remove inline hover styles if any
                $(this).parent().children('i').each(function() {
                     if($(this).data('value') <= val) $(this).css('color', '#ffc107');
                     else $(this).css('color', '#ccc');
                });
            });
            
            // Initialize stars (default 5)
            $('.star-rating i').each(function() {
                $(this).css('color', '#ffc107').addClass('fas').removeClass('far');
            });

            // Filter Buttons
            $('.filter-btn').click(function() {
                $('.filter-btn').removeClass('active border-primary text-primary').addClass('btn-outline-secondary bg-white');
                $(this).removeClass('btn-outline-secondary bg-white').addClass('active border-primary text-primary bg-white');
                const filter = $(this).data('filter');
                loadReviews(filter === 'all' ? null : filter);
            });

            // Submit Review
            $('#reviewForm').on('submit', function(e) {
                e.preventDefault();
                const rating = $('#ratingValue').val();
                const comment = $('#reviewComment').val();
                
                $.ajax({
                    url: '/DanhGia/Create',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        maVatTu: productId,
                        soSao: parseInt(rating),
                        chatLuongSanPham: parseInt(rating), // Assuming simple map
                        binhLuan: comment
                    }),
                    success: function(res) {
                        if (res.success) {
                            alert('Cảm ơn bạn đã đánh giá!');
                            $('#reviewForm')[0].reset();
                            loadReviews();
                        } else {
                            alert(res.message);
                        }
                    }
                });
            });
        });

        function loadReviews(starFilter) {
            let url = '/DanhGia/GetReviews?maVatTu=' + productId;
            if (starFilter) url += '&soSao=' + starFilter;

            $.get(url, function(res) {
                if(res.success) {
                    $('#avgScore').text(res.stats.diemTrungBinh);
                    // Render Stars for Avg
                    let starsHtml = '';
                    for(let i=1; i<=5; i++) {
                         if(i <= Math.round(res.stats.diemTrungBinh)) starsHtml += '<i class="fas fa-star"></i>';
                         else starsHtml += '<i class="far fa-star"></i>';
                    }
                    $('#avgStarsDisplay').html(starsHtml);
                    $('#headerRatingStars').html(starsHtml); // Update top header too

                    // Render List
                    const list = $('#reviewsList');
                    list.empty();
                    if(!res.reviews.length) {
                        list.html('<div class="text-center py-4 text-muted">Chưa có đánh giá nào.</div>');
                        return;
                    }
                    
                    res.reviews.forEach(r => {
                        let rStars = '';
                        for(let i=1; i<=5; i++) {
                             if(i <= r.soSao) rStars += '<i class="fas fa-star text-warning"></i>';
                             else rStars += '<i class="far fa-star text-secondary"></i>';
                        }
                        
                        // Default Avatar fallback if null (ui-avatars handles this in controller but just in case)
                        
                        const item = `
                            <div class="border-bottom pb-3">
                                <div class="d-flex gap-2 mb-2">
                                    <img src="${r.avatarUrl}" class="rounded-circle" width="40" height="40">
                                    <div>
                                        <div class="fs-6 fw-bold">${r.tenKhachHang}</div>
                                        <div class="small text-warning">${rStars}</div>
                                    </div>
                                    <div class="ms-auto text-muted small">${new Date(r.ngayDanhGia).toLocaleDateString('vi-VN')}</div>
                                </div>
                                <div class="text-muted mb-2 small">Chất lượng sản phẩm: ${r.soSao}/5</div>
                                <p class="mb-2" style="font-size: 0.95rem;">${r.binhLuan || ''}</p>
                                
                                <!-- Shop Reply Block -->
                                ${r.phanHoi ? `
                                    <div class="bg-light p-3 rounded-3 mb-2 border-start border-4 border-warning">
                                        <div class="d-flex align-items-center mb-1">
                                            <span class="badge bg-warning text-dark me-2">Phản hồi của Shop</span>
                                            <small class="text-muted">${new Date(r.ngayPhanHoi).toLocaleDateString('vi-VN')}</small>
                                        </div>
                                        <p class="mb-0 small text-dark">${r.phanHoi}</p>
                                    </div>
                                ` : ''}

                                <div class="d-flex gap-3">
                                    <button class="btn btn-sm text-muted p-0" onclick="likeReview(${r.id}, this)">
                                        <i class="far fa-thumbs-up"></i> <span>${r.luotThich || 0}</span> Hữu ích?
                                    </button>
                                </div>
                            </div>
                        `;
                        list.append(item);
                    });
                }
            });
        }
        
        function likeReview(id, btn) {
             $.ajax({
                url: '/DanhGia/Like',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ maDanhGia: id }),
                success: function(res) {
                    if (res.success) {
                         const span = $(btn).find('span');
                         span.text(res.luotThich);
                         const icon = $(btn).find('i');
                         if(res.liked) {
                             $(btn).addClass('text-primary');
                             icon.removeClass('far').addClass('fas');
                         } else {
                             $(btn).removeClass('text-primary');
                             icon.removeClass('fas').addClass('far');
                         }
                    }
                }
            });
        }
    </script>
}