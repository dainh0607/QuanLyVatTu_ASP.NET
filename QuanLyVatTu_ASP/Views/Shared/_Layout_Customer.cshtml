@using QuanLyVatTu_ASP.Repositories
@inject IUnitOfWork _unitOfWork
@{
    var _layoutCategories = await _unitOfWork.LoaiVatTuRepository.GetAllAsync();
}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Cửa hàng vật tư</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/user/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/user/css/Layout_Customer.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/user/css/cart-dropdown.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>
<body>
<header class="main-header">
    <div class="top-header py-3">
        <div class="container d-flex align-items-center justify-content-between">
            
            <div class="logo">
                <a href="/">
                    <span class="logo-icon">FN</span>
                    <span>Cửa hàng vật tư</span>
                </a>
            </div>

            <div class="search-box-wrapper">
                <form action="/Search" method="get" class="search-form">
                    <input type="text" name="q" placeholder="Tìm kiếm sản phẩm..." class="search-input" />
                    <button type="submit" class="search-btn">
                        <i class="fas fa-search"></i>
                    </button>
                </form>
            </div>

            
            <div class="header-actions">
                <a href="/GioHang/Wishlist" class="icon-btn">
                    <i class="fa-regular fa-heart"></i>
                    <span class="badge-count">0</span>
                </a>
                <div class="cart-dropdown-wrapper">
                            <a href="/GioHang/GioHang" class="icon-link cart-icon" title="Giỏ hàng">
                                <i class="fa-solid fa-cart-shopping"></i>
                                <span class="badge cart-count">5</span>
                            </a>
                            <!-- Cart Quick Preview Dropdown (Hover) -->
                            <div class="cart-quick-preview" id="cartQuickPreview">
                                <div class="cart-preview-header">
                                    <div class="cart-preview-title">
                                        <i class="fa-solid fa-shopping-bag"></i>
                                        <span>Giỏ hàng của bạn</span>
                                    </div>
                                    <span class="cart-items-badge">5 sản phẩm</span>
                                </div>
                                
                                <div class="cart-preview-items">
                                    <!-- Cart Item 1 -->
                                    <div class="cart-preview-item">
                                        <div class="cart-item-thumb">
                                            <img src="https://placehold.co/60x60/0d6efd/ffffff?text=Xi+Mang" alt="Xi măng">
                                        </div>
                                        <div class="cart-item-details">
                                            <h6 class="cart-item-name">Xi măng Holcim PCB40</h6>
                                            <div class="cart-item-meta">
                                                <span class="cart-item-price">125.000₫</span>
                                                <span class="cart-item-qty">x2</span>
                                            </div>
                                        </div>
                                        <button class="btn-remove-cart-item" title="Xóa sản phẩm">
                                            <i class="fa-regular fa-trash-can"></i>
                                        </button>
                                    </div>
                                    
                                    <!-- Cart Item 2 -->
                                    <div class="cart-preview-item">
                                        <div class="cart-item-thumb">
                                            <img src="https://placehold.co/60x60/ff6b00/ffffff?text=Day+Dien" alt="Dây điện">
                                        </div>
                                        <div class="cart-item-details">
                                            <h6 class="cart-item-name">Dây điện Cadivi 2.5mm</h6>
                                            <div class="cart-item-meta">
                                                <span class="cart-item-price">850.000₫</span>
                                                <span class="cart-item-qty">x1</span>
                                            </div>
                                        </div>
                                        <button class="btn-remove-cart-item" title="Xóa sản phẩm">
                                            <i class="fa-regular fa-trash-can"></i>
                                        </button>
                                    </div>
                                    
                                    <!-- Cart Item 3 -->
                                    <div class="cart-preview-item">
                                        <div class="cart-item-thumb">
                                            <img src="https://placehold.co/60x60/28a745/ffffff?text=Bua" alt="Búa">
                                        </div>
                                        <div class="cart-item-details">
                                            <h6 class="cart-item-name">Búa đinh Stanley 16oz</h6>
                                            <div class="cart-item-meta">
                                                <span class="cart-item-price">245.000₫</span>
                                                <span class="cart-item-qty">x1</span>
                                            </div>
                                        </div>
                                        <button class="btn-remove-cart-item" title="Xóa sản phẩm">
                                            <i class="fa-regular fa-trash-can"></i>
                                        </button>
                                    </div>
                                    
                                    <!-- Cart Item 4 -->
                                    <div class="cart-preview-item">
                                        <div class="cart-item-thumb">
                                            <img src="https://placehold.co/60x60/ffc107/ffffff?text=Son" alt="Sơn">
                                        </div>
                                        <div class="cart-item-details">
                                            <h6 class="cart-item-name">Sơn Dulux nội thất 5L</h6>
                                            <div class="cart-item-meta">
                                                <span class="cart-item-price">1.250.000₫</span>
                                                <span class="cart-item-qty">x2</span>
                                            </div>
                                        </div>
                                        <button class="btn-remove-cart-item" title="Xóa sản phẩm">
                                            <i class="fa-regular fa-trash-can"></i>
                                        </button>
                                    </div>
                                    
                                    <!-- Cart Item 5 -->
                                    <div class="cart-preview-item">
                                        <div class="cart-item-thumb">
                                            <img src="https://placehold.co/60x60/17a2b8/ffffff?text=Den+LED" alt="Đèn LED">
                                        </div>
                                        <div class="cart-item-details">
                                            <h6 class="cart-item-name">Đèn LED âm trần 12W</h6>
                                            <div class="cart-item-meta">
                                                <span class="cart-item-price">85.000₫</span>
                                                <span class="cart-item-qty">x4</span>
                                            </div>
                                        </div>
                                        <button class="btn-remove-cart-item" title="Xóa sản phẩm">
                                            <i class="fa-regular fa-trash-can"></i>
                                        </button>
                                    </div>
                                    
                                    <!-- Empty State (hidden when has items) -->
                                    <div class="cart-preview-empty" style="display: none;">
                                        <i class="fa-solid fa-cart-shopping"></i>
                                        <p>Giỏ hàng đang trống</p>
                                    </div>
                                </div>
                                
                                <div class="cart-preview-footer">
                                    <div class="cart-preview-total">
                                        <span>Tạm tính:</span>
                                        <strong>2.895.000₫</strong>
                                    </div>
                                    <div class="dropdown-actions">
                                        <a href="/GioHang/GioHang" class="btn-view-full-cart">
                                            <i class="fa-regular fa-eye"></i>
                                            Xem giỏ hàng
                                        </a>
                                        <a href="/ThanhToan/Checkout" class="btn-checkout">
                                            Thanh toán
                                            <i class="fa-solid fa-arrow-right"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                @if (User.Identity?.IsAuthenticated == true)
                {
                    <div class="dropdown">
                        <a href="#" class="d-flex align-items-center gap-2 text-decoration-none text-dark" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle fa-lg text-white"></i> <span class="text-white">@User.Identity.Name</span> </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="/Customer/Profile">Tài khoản</a></li>
                            <li><a class="dropdown-item" href="/Customer/Orders">Đơn hàng</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="/Account/Logout">Đăng xuất</a></li>
                        </ul>
                    </div>
                }
                else
                {
                    <div class="auth-buttons">
                        <a href="/Account/Login" class="btn-login">Đăng nhập</a>
                        <a href="/Account/Login?show=register" class="btn-register">Đăng ký</a>
                    </div>
                }
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="container">
            <ul class="nav-menu">
                <li class="nav-item"><a href="/" class="nav-link">Trang chủ</a></li>
                <li class="nav-item">
                    <a href="/SanPham" class="nav-link">
                        Danh mục <i class="fas fa-chevron-down ms-1" style="font-size: 0.8em;"></i>
                    </a>
                    <div class="dropdown-menu">
                        <a href="/SanPham" class="dropdown-item">Tất cả sản phẩm</a>
                        @if (_layoutCategories != null)
                        {
                            foreach (var cat in _layoutCategories)
                            {
                                <a href="/SanPham?loaiId=@cat.ID" class="dropdown-item">@cat.TenLoaiVatTu</a>
                            }
                        }
                    </div>
                </li>
                <li class="nav-item"><a href="/Customer/About" class="nav-link">Giới thiệu</a></li>
                <li class="nav-item"><a href="/Contact" class="nav-link">Liên hệ</a></li>
            </ul>
        </div>
    </div>
</header>

    <main role="main">
        @RenderBody()
    </main>
<footer class="main-footer">
    <div class="container">
        <div class="footer-top row">
            <!-- Cột liên hệ -->
            <div class="col-md-3 col-sm-6 mb-4">
                <h5 class="footer-title">Liên hệ</h5>
                <ul class="footer-links list-unstyled">
                    <li><i class="bi bi-clock me-2"></i>Liên hệ trong giờ làm việc</li>
                    <li><i class="bi bi-chat-dots me-2"></i>Zalo: 0302370432</li>
                    <li><i class="bi bi-envelope me-2"></i>Email: dainhtb01722@gmail.com</li>
                </ul>
            </div>
            
            <!-- Cột về chúng tôi -->
            <div class="col-md-3 col-sm-6 mb-4">
                <h5 class="footer-title">Về chúng tôi</h5>
                <ul class="footer-links list-unstyled">
                    <li><a href="#"><i class="bi bi-info-circle me-2"></i>Giới thiệu</a></li>
                    <li><a href="#"><i class="bi bi-telephone me-2"></i>Liên hệ</a></li>
                    <li><a href="#"><i class="bi bi-question-circle me-2"></i>FAQs</a></li>
                </ul>
            </div>
            
            <!-- Cột chính sách -->
            <div class="col-md-3 col-sm-6 mb-4">
                <h5 class="footer-title">Chính sách</h5>
                <ul class="footer-links list-unstyled">
                    <li><a href="#"><i class="bi bi-cart-check me-2"></i>Hướng dẫn mua hàng</a></li>
                    <li><a href="#"><i class="bi bi-credit-card me-2"></i>Điều khoản thanh toán</a></li>
                    <li><a href="#"><i class="bi bi-truck me-2"></i>Giao hàng - vận chuyển</a></li>
                    <li><a href="#"><i class="bi bi-shield-check me-2"></i>Chính sách bảo hành</a></li>
                </ul>
            </div>
            
            <!-- Cột hợp tác -->
            <div class="col-md-3 col-sm-6 mb-4">
                <h5 class="footer-title">Hợp tác</h5>
                <ul class="footer-links list-unstyled">
                    <li><a href="#"><i class="bi bi-person-plus me-2"></i>Tuyển dụng</a></li>
                    <li><a href="#"><i class="bi bi-handshake me-2"></i>Chính sách đại lý</a></li>
                </ul>
            </div>
        </div>
        
        <!-- Dòng bên dưới với bản quyền và mạng xã hội -->
        <div class="footer-bottom border-top border-secondary pt-4 mt-4">
            <div class="row align-items-center">
                <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                    <p class="mb-0">&copy; 2025 Furniture Store. Tất cả quyền được bảo lưu.</p>
                </div>
                <div class="col-md-6 text-center text-md-end">
                    <div class="social-icons">
                        <a href="#" class="btn btn-outline-light btn-sm me-2">
                            <i class="bi bi-facebook me-1"></i>Facebook
                        </a>
                        <a href="#" class="btn btn-outline-light btn-sm me-2">
                            <i class="bi bi-instagram me-1"></i>Instagram
                        </a>
                        <a href="#" class="btn btn-outline-light btn-sm">
                            <i class="bi bi-chat-dots me-1"></i>Zalo
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>

    <!-- Global Message Modal -->
    <div class="modal fade" id="globalMessageModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title fw-bold" id="globalMessageTitle">Thông báo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center py-4">
                    <div class="mb-3">
                        <i class="fas fa-info-circle text-primary" style="font-size: 3rem;" id="globalMessageIcon"></i>
                    </div>
                    <p id="globalMessageContent" class="fs-5">Nội dung thông báo</p>
                </div>
                <div class="modal-footer border-0 justify-content-center">
                    <button type="button" class="btn btn-primary px-4 rounded-pill" data-bs-dismiss="modal">Đóng</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Global Confirm Modal -->
    <div class="modal fade" id="globalConfirmModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title fw-bold" id="globalConfirmTitle">Xác nhận</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center py-4">
                    <div class="mb-3">
                        <i class="fas fa-question-circle text-warning" style="font-size: 3rem;"></i>
                    </div>
                    <p id="globalConfirmContent" class="fs-5">Bạn có chắc chắn muốn thực hiện?</p>
                </div>
                <div class="modal-footer border-0 justify-content-center">
                    <button type="button" class="btn btn-secondary px-4 rounded-pill" data-bs-dismiss="modal">Hủy</button>
                    <button type="button" class="btn btn-danger px-4 rounded-pill" id="globalConfirmBtn">Đồng ý</button>
                </div>
            </div>
        </div>
    </div>

    <script src="~/user/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/user/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/user/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)
    @await RenderSectionAsync("Styles", required: false)
    <script>
        // Global variables for Modals
        var confirmCallback = null;
        var messageModal = null;
        var confirmModal = null;

        document.addEventListener('DOMContentLoaded', function() {
            // Mobile menu toggle
            const menuToggle = document.getElementById('mobileMenuToggle');
            if (menuToggle) {
                menuToggle.addEventListener('click', function() {
                    const nav = document.getElementById('mainNav');
                    if (nav) nav.classList.toggle('active');
                });
            }

            // Search functionality
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', function(e) {
                    const searchTerm = e.target.value.trim();
                    const suggestions = document.getElementById('searchSuggestions');
                    if (suggestions) {
                        if (searchTerm.length > 2) {
                            suggestions.style.display = 'block';
                        } else {
                            suggestions.style.display = 'none';
                        }
                    }
                });
            }
            
            // User dropdown
            document.querySelectorAll('.user-dropdown').forEach(dropdown => {
                const toggle = dropdown.querySelector('.user-info');
                const menu = dropdown.querySelector('.user-menu');
                if (toggle && menu) {
                    toggle.addEventListener('click', function(e) {
                        e.preventDefault();
                        menu.classList.toggle('show');
                    });
                }
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                document.querySelectorAll('.user-dropdown').forEach(dropdown => {
                     const menu = dropdown.querySelector('.user-menu');
                     if (menu && !dropdown.contains(e.target)) {
                         menu.classList.remove('show');
                     }
                });
            });

            // Initialize Modals
            const msgEl = document.getElementById('globalMessageModal');
            if (msgEl) messageModal = new bootstrap.Modal(msgEl);

            const confirmEl = document.getElementById('globalConfirmModal');
            if (confirmEl) confirmModal = new bootstrap.Modal(confirmEl);

            // Confirm Button Listener
            const confirmBtn = document.getElementById('globalConfirmBtn');
            if (confirmBtn) {
                confirmBtn.addEventListener('click', function() {
                    if (confirmCallback) {
                        confirmCallback();
                    }
                    if (confirmModal) confirmModal.hide();
                });
            }

            // Quick cart preview
            const cartIcon = document.querySelector('.cart-icon');
            if(cartIcon) {
                 cartIcon.addEventListener('mouseenter', function() {
                    // Preview logic
                });
            }
        });

        // Global Helper Functions attached to window
        window.showGlobalMessage = function(message, title = "Thông báo", type = "info") {
            const contentEl = document.getElementById('globalMessageContent');
            const titleEl = document.getElementById('globalMessageTitle');
            const iconEl = document.getElementById('globalMessageIcon');
            
            if (contentEl) contentEl.innerText = message;
            if (titleEl) titleEl.innerText = title;
            
            if (iconEl) {
                iconEl.className = ''; // Reset
                if (type === 'success') {
                    iconEl.className = 'fas fa-check-circle text-success';
                    iconEl.style.fontSize = '3rem';
                } else if (type === 'error') {
                    iconEl.className = 'fas fa-times-circle text-danger';
                    iconEl.style.fontSize = '3rem';
                } else {
                    iconEl.className = 'fas fa-info-circle text-primary';
                    iconEl.style.fontSize = '3rem';
                }
            }
            
            if (messageModal) messageModal.show();
        };

        window.showGlobalConfirm = function(message, callback) {
            const contentEl = document.getElementById('globalConfirmContent');
            if (contentEl) contentEl.innerText = message;
            
            confirmCallback = callback;
            
            if (confirmModal) confirmModal.show();
        };

        function updateCartCount(count) {
            document.querySelectorAll('.cart-count, .badge').forEach(el => {
                el.textContent = count;
            });
        }
    </script>
</body>
</html>